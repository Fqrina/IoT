<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>VoltStream â€” Grafik</title>
  <link rel="stylesheet" href="style.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" referrerpolicy="no-referrer" />
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body { margin:0; font-family:"Segoe UI",sans-serif; background:#0a0a0a; color:#fff; }
    header { padding:1rem; font-weight:bold; font-size:1.2rem; }
    .chart-container { margin:1rem; padding:1rem; background:#111; border-radius:15px; }
    canvas { width:100% !important; height:260px !important; display:block; }
    .chart-title { text-align:center; color:#e5e5e5; font-weight:600; margin-top:8px; }
    /* Bottom nav: samakan dengan dashboard */
    .bottom-nav { position:fixed; bottom:22px; left:50%; transform:translateX(-50%);
      background:linear-gradient(135deg,#7b2ff7,#00c6ff); border-radius:30px; display:flex; justify-content:space-between; align-items:center; gap:8px; padding:0.7rem 1.1rem; width:88%; max-width:400px; }
    .bottom-item { text-align:center; font-size:0.7rem; flex:1; }
    .bottom-nav a { color:#fff; text-decoration:none; display:flex; flex-direction:column; align-items:center; gap:2px; text-shadow:0 1px 1px rgba(0,0,0,.25); }
    .bottom-nav a span { font-size:0.95rem; font-weight:700; letter-spacing:.2px; }
    .bottom-nav a i { font-size:1.35rem; }
  </style>
</head>
<body>
  <header>Grafik Energi per Sungai</header>

  <div class="chart-container"><canvas id="chart-buaran"></canvas><div class="chart-title">Buaran</div></div>
  <div class="chart-container"><canvas id="chart-cakung"></canvas><div class="chart-title">Cakung</div></div>
  <div class="chart-container"><canvas id="chart-cilliwung"></canvas><div class="chart-title">Cilliwung</div></div>
  <div class="chart-container"><canvas id="chart-kalimalang"></canvas><div class="chart-title">Kalimalang</div></div>
  <div class="chart-container"><canvas id="chart-sunter"></canvas><div class="chart-title">Sunter</div></div>

  <div class="bottom-nav">
    <div class="bottom-item"><a href="dashboard.html"><i class="fas fa-th-large"></i><span>Dashboard</span></a></div>
    <div class="bottom-item"><a href="graph.html"><i class="fas fa-chart-bar"></i><span>Grafik</span></a></div>
    <div class="bottom-item"><a href="map.html"><i class="fas fa-location-dot"></i><span>Peta</span></a></div>
    <div class="bottom-item"><a href="feedback.html"><i class="fas fa-user"></i><span>Feedback</span></a></div>
  </div>

  <script>
    function hourLabel(ts){ const d = new Date(ts*1000); return String(d.getHours()).padStart(2,'0'); }
    function buildChart(canvasId, color){
      const ctx = document.getElementById(canvasId);
      return new Chart(ctx, {
        type: 'line',
        data: { labels: [], datasets: [{ label: 'Voltage (V)', data: [], borderColor: color, backgroundColor: 'rgba(123,47,247,0.18)', fill:true, tension:0.3 }] },
        options: { responsive:true, maintainAspectRatio:false, scales:{ y:{ ticks:{ color:'#fff' } }, x:{ ticks:{ color:'#fff' } } }, plugins:{ legend:{ labels:{ color:'#fff' } } } }
      });
    }

    const charts = {
      buaran:  buildChart('chart-buaran', '#00c6ff'),
      cakung:  buildChart('chart-cakung', '#66e3ff'),
      cilliwung: buildChart('chart-cilliwung', '#8bd3ff'),
      kalimalang: buildChart('chart-kalimalang', '#58b7ff'),
      sunter: buildChart('chart-sunter', '#3aa0ff'),
    };

    async function refreshOne(cls){
      try{
        const res = await fetch(`/api/data?cls=${cls}`);
        const rows = await res.json();
        const ordered = rows.slice().reverse();
        const chart = charts[cls];
        if (chart){
          chart.data.labels = ordered.map(r => hourLabel(r.ts));
          chart.data.datasets[0].data = ordered.map(r => r.voltage);
          chart.update();
        }
      }catch(e){ /* ignore */ }
    }

    function refreshAll(){
      ['buaran','cakung','cilliwung','kalimalang','sunter'].forEach(refreshOne);
    }
    refreshAll();
    setInterval(refreshAll, 30000);
  </script>
</body>
</html>

